## so21b - trabalho 4

### Criação dinâmica de processos

Até agora, os processos são criados na inicialização do SO.
Nesta etapa, colocaremos suporte à criação de processos a qualquer instante.

Para que um processo possa ser criado para executar um programa, necessitamos de uma forma de descrever as neseccidades desse programa -- quanto de memória ele necessita, qual o conteúdo inicial dessa memória (o código e dados inicializados do programa), quais dispositivos de E/S ele usa, em quais arquivos são mapeados esses dispositivos.
Normalmente, essas informações estão em um arquivo, que contém um programa executável, ou são informadas ao sistema durante a execução do programa (com chamada de sistema para abertura de arquivo, por exemplo).
No nosso caso, por simplicidade, vamos manter essas informações em um vetor. Cada programa será identificado por um número, que corresponde à entrada nesse vetor.
Teremos uma nova chamada de sistema (simulado por uma instrução privilegiada) para realizar a criação de um processo, que tem como argumento um número, que é o descritor do programa que o novo processo deve executar.
Na inicialização do sistema, um único processo será criado, para executar o programa contido no primeiro desses descritores.
Se o usuário quiser que o sistema execute outros processos, eles devem ser criados dinamicamente pelos processos em execução.

A nova instrução tem opcode 21:

| código |   nome | #arg | operação  | descrição |
| -----: | :----- | :--: | :-------- | :-------- |
|      0 | NOP    | 0    | -         | não faz nada |
|      1 | PARA   | 0    | fim do processo (priv) | chamada de sistema para terminar processo |
|      2 | CARGI  | 1    | A=A1      | carrega imediato |
|      3 | CARGM  | 1    | A=mem[A1] | carrega da memória |
|      4 | CARGX  | 1    | A=mem[A1+X] | carrega indexado |
|      5 | ARMM   | 1    | mem[A1]=A | armazena na memória |
|      6 | ARMX   | 1    | mem[A1+X]=A | armazena indexado |
|      7 | MVAX   | 0    | X=A       | inicializa X |
|      8 | MVXA   | 0    | A=X       | recupera X |
|      9 | INCX   | 0    | X++       | incrementa X |
|     10 | SOMA   | 1    | A+=mem[A1] | soma |
|     11 | SUB    | 1    | A-=mem[A1] | subtração |
|     12 | MULT   | 1    | A*=mem[A1] | multiplicação |
|     13 | DIV    | 1    | A/=mem[A1] | divisão |
|     14 | RESTO  | 1    | A%=mem[A1] | resto |
|     15 | NEG    | 0    | A=-A       | negação |
|     16 | DESV   | 1    | PC=A1      | desvio |
|     17 | DESVZ  | 1    | se A for 0, PC=A1 | desvio condicional |
|     18 | DESVNZ | 1    | se A não for 0, PC=A1 | desvio condicional |
|     19 | LE     | 1    | A=es[A1] (priv)   | leitura do dispositivo A1 |
|     20 | ESCR   | 1    | es[A1]=A (priv)  | escrita no dispositivo A1 |
|     21 | CRIA   | 1    | cria processo (priv) | cria um novo processo, que deve executar o programa do descritor A1 |


### Bloqueio em E/S
